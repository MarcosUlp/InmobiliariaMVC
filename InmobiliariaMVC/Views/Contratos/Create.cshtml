@model InmobiliariaMVC.Models.Contrato

@{
    ViewData["Title"] = "Crear Contrato";
    var inmuebles = ViewBag.Inmuebles as List<InmobiliariaMVC.Models.Inmueble> ?? new
    List<InmobiliariaMVC.Models.Inmueble>();
    var inquilinos = ViewBag.Inquilinos as List<InmobiliariaMVC.Models.Inquilino> ?? new
    List<InmobiliariaMVC.Models.Inquilino>();
    var inmueblesDisponibles = ViewBag.InmueblesDisponibles as List<InmobiliariaMVC.Models.Inmueble> ?? new
    List<InmobiliariaMVC.Models.Inmueble>();
}

<h1>Crear Contrato</h1>
<hr />

<div class="row">
    <div class="col-md-6">
        <!-- FORMULARIO CREAR CONTRATO -->
        <form asp-action="Create" method="post">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>

            <div class="form-group">
                <label asp-for="IdInmueble" class="control-label"></label>
                <select class="form-control" asp-for="IdInmueble"
                    asp-items="@(new SelectList(inmuebles, "IdInmueble", "Direccion"))">
                    <option value="">-- Seleccione Inmueble --</option>
                </select>
                <span asp-validation-for="IdInmueble" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="IdInquilino" class="control-label"></label>
                <select class="form-control" asp-for="IdInquilino"
                    asp-items="@(new SelectList(inquilinos, "IdInquilino", "Nombre"))">
                    <option value="">-- Seleccione Inquilino --</option>
                </select>
                <span asp-validation-for="IdInquilino" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="FechaInicio" class="control-label"></label>
                <input asp-for="FechaInicio" class="form-control" type="date" />
                <span asp-validation-for="FechaInicio" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="FechaFin" class="control-label"></label>
                <input asp-for="FechaFin" class="form-control" type="date" />
                <span asp-validation-for="FechaFin" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="PrecioMensual" class="control-label"></label>
                <input asp-for="PrecioMensual" class="form-control" />
                <span asp-validation-for="PrecioMensual" class="text-danger"></span>
            </div>

            <input type="hidden" asp-for="Estado" value="true" />

            <div class="form-group mt-2">
                <input type="submit" value="Crear Contrato" class="btn btn-primary" name="accion" value="crear" />
            </div>
        </form>

        <hr />

        <!-- FORMULARIO LISTAR INMUEBLES DISPONIBLES -->
        <form method="post" asp-action="Create">
            <div class="form-group">
                <label>Fecha Inicio</label>
                <input type="date" name="FechaInicio" class="form-control"
                    value="@Model.FechaInicio.ToString("yyyy-MM-dd")" />
            </div>
            <div class="form-group">
                <label>Fecha Fin</label>
                <input type="date" name="FechaFin" class="form-control"
                    value="@Model.FechaFin.ToString("yyyy-MM-dd")" />
            </div>
            <button type="submit" class="btn btn-info mt-2" name="accion" value="listar">
                Listar inmuebles disponibles
            </button>
        </form>

        @if (TempData["Error"] != null)
        {
            <div class="alert alert-danger mt-2">
                @TempData["Error"]
            </div>
        }
        @if (TempData["Success"] != null)
        {
            <div class="alert alert-success mt-2">
                @TempData["Success"]
            </div>
        }
    </div>
</div>

@if (inmueblesDisponibles.Any())
{
    <h2>Inmuebles disponibles entre @ViewBag.FechaInicio?.ToShortDateString() y @ViewBag.FechaFin?.ToShortDateString()</h2>

    <table class="table table-striped mt-2">
        <thead>
            <tr>
                <th>Direcci√≥n</th>
                <th>Uso</th>
                <th>Tipo</th>
                <th>Ambientes</th>
                <th>Superficie</th>
                <th>Precio</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var inmueble in inmueblesDisponibles)
            {
                <tr>
                    <td>@inmueble.Direccion</td>
                    <td>@inmueble.Uso</td>
                    <td>@inmueble.Tipo</td>
                    <td>@inmueble.Ambientes</td>
                    <td>@inmueble.Superficie</td>
                    <td>@inmueble.Precio</td>
                </tr>
            }
        </tbody>
    </table>
}
else if (ViewBag.InmueblesDisponibles != null)
{
    <div class="alert alert-warning mt-2">
        No hay inmuebles disponibles en este rango de fechas.
    </div>
}